<!DOCTYPE html>
<html>
<head>
<style>
  table{
    border:1px solid black;
  }
  td{
    width:30px;
    height:30px;
  }
  div{
    border:0px solid black;
  }
  #frame {
    width:1024px;
    margin:auto;
  }

  #startimgdisplay {
  position:relative;
  width:1024px;
  height:576px;
  margin:0 auto;
  }

  /* #startimgdisplay img {
  position:absolute;
  left:0;
  -webkit-transition: opacity 1s ease-in-out;
  -moz-transition: opacity 1s ease-in-out;
  -o-transition: opacity 1s ease-in-out;
  transition: opacity 1s ease-in-out;
  }

#startimgdisplay img.top:hover {
  opacity:0;
}*/
#dashboard {
  position:absolute;
  margin:auto;
  width:1024px;
  background-image: url("images/wall1.jpg");
}
#logDisplay{
  height:226px;
  overflow-y:hidden;
  flex-direction:column-reverse;
  display:flex;
  padding-left:35px;
  color:lightgray;
  margin-top:20px;
}
.maptable {
  border:1px solid #5a5a5a;
  background:#5a5a5a;
}
.maptable td{
  width:37px;
  height:37px;
}
.directionalbutton {
  background-color: transparent;
  border:0;
  margin:0;
}
.directionalbuttonimg {
  width: 45px;
  heigh: 40px;
}
.directionalbuttonimg:active {
  width: 40px;
  heigh: 35px;
  filter: drop-shadow(0 0 0 yellow);
  transition: filter 0s;
}

#imgmotherframe {
  position:relative;
  padding:auto;
  height:576px;
}

#imgoverlay {
  position:absolute;
  top: 50%;
  left: 50%;
  transform: translateY(-50%) translateX(-50%);
  width:300px;
  height:200px;
  z-index:2;
  visibility:visible;
  opacity:1;
  -webkit-transition: opacity 0.2s ease-in-out;
  -moz-transition: opacity 0.2s ease-in-out;
  -o-transition: opacity 0.2s ease-in-out;
  transition: opacity 0.2s ease-in-out;
  text-align:center;
}
#imgdisplay {
  position:absolute;
  z-index:1;
}
#startbutton {
  -webkit-transition: filter 0.4s ease-in-out;
  -moz-transition: filter 0.4s ease-in-out;
  -o-transition: filter 0.4s ease-in-out;
  transition: filter 0.4s ease-in-out;
  filter: brightness(90%);
}
#startbutton:hover{
filter: brightness(170%);
}
</style>
</head>
<body bgcolor="#000000">
<div id="frame"><div id="imgmotherframe">
  <div id="imgdisplay"><div id="startimgdisplay"><img src='images/entrance2.jpeg' id='entrance' class="top"></div></div>
  <div id="imgoverlay"><button type="button" name="button" onclick="startGame();" class="directionalbutton" id="startbutton"><img src='images/Start.png'></button>
  </div></div>
<div id="dashboard">
  <table style="border:0px;">
    <tr><td style="width:255px;text-align:center;padding-left:5px">
      <div id="map"></div>
    </td><td style="width:350px;background-image: url('images/log2.png');background-repeat: no-repeat;">
      <div id="logDisplay"></div></td><td style="width:200px;text-align:center;">
        <div id="move">
          <table style="border:0px;"><tr><td>
          <button type="button" name="button" onclick="movePlayer('NW')" class="directionalbutton"><img src='images/NW2.png' class="directionalbuttonimg"></button></td><td>
          <button type="button" name="button" onclick="movePlayer('N')" class="directionalbutton"><img src='images/N2.png' class="directionalbuttonimg"></button></td><td>
          <button type="button" name="button" onclick="movePlayer('NE')" class="directionalbutton"><img src='images/NE2.png' class="directionalbuttonimg"></button></td></tr><tr><td>
          <button type="button" name="button" onclick="movePlayer('W')" class="directionalbutton"><img src='images/W2.png' class="directionalbuttonimg"></button></td><td></td><td>
          <button type="button" name="button" onclick="movePlayer('E')" class="directionalbutton"><img src='images/E2.png' class="directionalbuttonimg"></button></td></tr><tr><td>
          <button type="button" name="button" onclick="movePlayer('SW')" class="directionalbutton"><img src='images/SW2.png' class="directionalbuttonimg"></button></td><td>
          <button type="button" name="button" onclick="movePlayer('S')" class="directionalbutton"><img src='images/S2.png' class="directionalbuttonimg"></button></td><td>
          <button type="button" name="button" onclick="movePlayer('SE')" class="directionalbutton"><img src='images/SE2.png' class="directionalbuttonimg"></button></td></tr></table>
        </div><p></p>
        <div id="action">

          <table style="border:0px;margin:auto"><tr><td style="text-align:center; height:40px; width:60px;">
          <button type="button" name="button" onclick="combat('attack')" class="directionalbutton"><img src='images/btn-ATK.png' class="directionalbuttonimg"></button></td><td style="text-align:center; height:40px; width:60px;">
          <button type="button" name="button" onclick="combat('spell')" class="directionalbutton"><img src='images/btn-magic.png' class="directionalbuttonimg"></button></td></tr><tr><td colspan="2" style="text-align:center; height:45px;">
          <button type="button" name="button" onclick="openTreasure()" class="directionalbutton"><img src='images/btn-open.png' class="directionalbuttonimg"></button></td></tr></table>
        </div></td><td style="width:150px;background-image: url('images/parchmentINV3.png');background-repeat: no-repeat; padding-left:35px;padding-right:20px;vertical-align:top; padding-top:30px;" >
          <div id="hud"><img src='images/stats.png'><br><span style="color:white;">Here you can keep track of your character stats.</span>

          </div>
          <div id="equipmentDisplay"><img src='images/inventory.png'><br><span style="color:white;">Here your inventory will be displayed.</span></div>
        </td></tr></table>
      </div>
    </div>

<script>
  //basic variables
  var matrix = [
  [0,0,0,0,0,0],
  [0,0,0,0,0,0],
  [0,0,0,0,0,0],
  [0,0,0,0,0,0],
  [0,0,0,0,0,0],
  [0,0,0,0,0,0]
  ];
  var currentPosition=[0,0];
  var carryOverTarget=[7,7];
  var playerLVL = 1;
  var playerlvlP = 0;
  var playerLives = 3;
  var maxLives = 3;
  var playerMana = 1;
  var maxMana = 1;
  var equipment = [0,0,0,0]; //[spell, shield, sword, macguffin]
  var moveLock = true;
  var adventureLog = "";
  var gameHasStarted = false;
  var finalScore = 0;
  var cClass = 'paladin';

  //Create audio assets
  var startclick = new Audio('sound/startclick.mp3');
  var audiofrontdoor = new Audio('sound/frontdoor1.mp3');
  var audiosteps = new Audio('sound/steps2.m4a');
  var audioslime = new Audio('sound/slime.mp3');
  var audiohulk = new Audio('sound/hulk.mp3');
  var audiodragon = new Audio('sound/dragon.mp3');
  var audiomonsterkill = new Audio('sound/monsterkill1.mp3');
  var audiohurt = new Audio('sound/hurt.m4a');
  var audioplayerdeath = new Audio('sound/playerdeath.m4a');
  var audiospell = new Audio('sound/lightning.mp3');
  var audioslash = new Audio('sound/slash.mp3');
  var audiolvlup = new Audio('sound/lvlupfanfare.mp3');
  var audiotreasure = new Audio('sound/treasureah.mp3');
  var audiowin = new Audio('sound/winfanfare.mp3');
  var audiotreasurefind = new Audio('sound/treasure.mp3');
  var audiobgm = new Audio('sound/bgm2.mp3');
  audiobgm.loop = true;
  audiobgm.volume = 0.3;

  var audiopaladin = new Audio('sound/paladinsb.mp3');
  var audiobarbarian = new Audio('sound/barbariansb.mp3');
  var audiowizard = new Audio('sound/wizardsb.mp3');
  var audiothief = new Audio('sound/thiefsb1.mp3');

  //Create all Image Assets
  var icnhero = "<img src='images/Paladin30.png'>";

  var incstats = "<img src='images/stats.png'>";
  var increstart = "<img src='images/Restart.png'>";
  var inclife = "<img src='images/life.png'>";
  var incmana = "<img src='images/mana.png'>";
  var inclvl = "<img src='images/lvl.png'>";
  var incprog = "<img src='images/prog.png'>";
  var icnlvlpoint = "<img src='images/lvlpoint.png'>";
  var icnmanapoint = "<img src='images/manapoint.png'>";
  var icnlifepoint = "<img src='images/lifepoint.png'>";
  var icnskull1 = "<img src='images/Skull130.png'>";
  var icnskull2 = "<img src='images/Skull230.png'>";
  var icnskull3 = "<img src='images/Skull330.png'>";
  var icnchest = "<img src='images/chest30.png'>";
  var icninventory = "<img src='images/inventory.png'>";
  var icnspell = "<img src='images/spell2.png'>";
  var icnshield = "<img src='images/shield2.png'>";
  var icnsword = "<img src='images/sword2.png'>";

  var imgdeath = "<img src='images/death1GO.jpeg' onclick='location.reload()'>";
  var imgwin1 = "<img src='images/win1GO.jpeg' onclick='location.reload()'>";
  var imgwin2 = "<img src='images/win2GO.jpeg' onclick='location.reload()'>";
  var imgtreasure1 = "<img src='images/treasure1.jpeg'>";
  var imgtreasure2 = "<img src='images/treasure2.jpeg'>";
  var imgtreasure3 = "<img src='images/treasure3.jpeg'>";
  var imgtreasure4 = "<img src='images/treasure4.jpeg'>";
  var imgmonster1 = "<img src='images/Monster1.jpeg'>";
  var imgmonster2 = "<img src='images/Monster2.jpeg'>";
  var imgmonster3 = "<img src='images/Monster3.jpeg'>";
  var imgmonster4 = "<img src='images/Monster4.jpeg'>";
  var imgmonster5 = "<img src='images/Monster5.jpeg'>";
  var imgmonster6 = "<img src='images/images/Monster6.jpeg'>";
  var imgmonster7 = "<img src='images/Monster7.jpeg'>";
  var imgmonster8 = "<img src='images/Monster8.jpeg'>";
  var imgmonster9 = "<img src='images/Monster9.jpeg'>";
  var imgmonster10 = "<img src='images/Monster10.jpeg'>";
  var imgmonster11 = "<img src='images/Monster11.jpeg'>";
  var imgmonster12 = "<img src='images/Monster12.jpeg'>";
  var imgroomsplat = "<img src='images/room5splatter.jpeg'>";
  var imgentrance1 = "<img src='images/entrance2ST.jpeg'>";
  var imgentrance2 = "<img src='images/entrance2.jpeg'>";
  var imgroom6 = "<img src='images/room6.jpeg'>";
  var imgroom4 = "<img src='images/room4.jpeg'>";
  var imgroom2 = "<img src='images/room2.jpeg'>";
  var imgroom1 = "<img src='images/room1.jpeg'>";
  var imgroom3 ="<img src='images/room3.jpeg'>";
  var imgbloodsplat = "<img src='images/bloodsplat.png'>";
  var imgswordstrike = "<img src='images/swordstrike.png'>";
  var imgspellcast = "<img src='images/spellcast.png'>";
  var imggethealthpotion = "<img src='images/gethealthpotion.png'>";
  var imggetmanapotion = "<img src='images/getmanapotion.png'>";
  var imggetsword = "<img src='images/getsword.png'>";
  var imggetshield = "<img src='images/getshield.png'>";
  var imggetspell = "<img src='images/getspell.png'>";
  var imgdarktile = 'images/imgdarktile.png';
  var imglighttile = 'images/imglighttile.png';
  var imgwalltile = 'images/imgwalltile.png';


  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms)); // useage: await sleep(<duration>); //id: imgoverlay
  }
  function startGame() {
    startclick.play();
    var startscreen = '<br><span style="color:white;font-size:20;font-weight:bold;">Choose your Character</span><br><img src="images/Paladinbig.png" style="opacity:1;background:rgba(85.5, 242.5, 244.9, 0.5);margin-left:-7px;" id="chosepaladin" onmouseover="chosehighlight(\'paladin\');" onclick="chosecharacter(\'paladin\');">  <img src="images/Barbarianbig.png" style="opacity:0.6;background:rgba(85.5, 242.5, 244.9, 0.5);" id="chosebarbarian" onmouseover="chosehighlight(\'barbarian\')" onclick="chosecharacter(\'barbarian\')"> <br> <img src="images/Thiefbig.png" style="opacity:0.6;background:rgba(85.5, 242.5, 244.9, 0.5);" id="chosethief" onmouseover="chosehighlight(\'tief\')" onclick="chosecharacter(\'tief\')"> <img src="images/Wizardbig.png" style="opacity:0.6;background:rgba(85.5, 242.5, 244.9, 0.5);" id="chosewizard" onmouseover="chosehighlight(\'wizard\')" onclick="chosecharacter(\'wizard\')">"';
    document.getElementById("imgoverlay").innerHTML = startscreen;
  }

  function createDungeon() {
    audiobgm.play();
    audiofrontdoor.play();
    for (let i = 0; i < 10; i++) {
      var x = Math.floor(Math.random() * 6);
      var y = Math.floor(Math.random() * 6);
      matrix[y][x] = 1;
    }
    document.getElementById("imgdisplay").innerHTML = getRoom();
    adventureLog += "You have entered the dungeon!<br>";
    document.getElementById("logDisplay").innerHTML = adventureLog;
    addPlayer();
    reddrawDungeon();
    document.getElementById("imgoverlay").style.opacity = "0";
    document.getElementById("imgoverlay").style.visibility = "hidden";
    gameHasStarted = true;
  }

  function chosehighlight(type){
    if (type == 'paladin') {
      audiobarbarian.pause();
      audiobarbarian.currentTime = 0;
      audiowizard.pause();
      audiowizard.currentTime = 0;
      audiothief.pause();
      audiothief.currentTime = 0;
      audiopaladin.play();

      document.getElementById("chosepaladin").style.opacity = "1";
      document.getElementById("chosebarbarian").style.opacity = "0.6";
      document.getElementById("chosethief").style.opacity = "0.6";
      document.getElementById("chosewizard").style.opacity = "0.6";
    }else if (type == 'barbarian') {
      audiopaladin.pause();
      audiopaladin.currentTime = 0;
      audiowizard.pause();
      audiowizard.currentTime = 0;
      audiothief.pause();
      audiothief.currentTime = 0;

      audiobarbarian.play();

      document.getElementById("chosepaladin").style.opacity = "0.6";
      document.getElementById("chosebarbarian").style.opacity = "1";
      document.getElementById("chosethief").style.opacity = "0.6";
      document.getElementById("chosewizard").style.opacity = "0.6";
    }else if (type == 'tief') {
      audiopaladin.pause();
      audiopaladin.currentTime = 0;
      audiowizard.pause();
      audiowizard.currentTime = 0;
      audiobarbarian.pause();
      audiobarbarian.currentTime = 0;
      audiothief.play();


      document.getElementById("chosepaladin").style.opacity = "0.6";
      document.getElementById("chosebarbarian").style.opacity = "0.6";
      document.getElementById("chosethief").style.opacity = "1";
      document.getElementById("chosewizard").style.opacity = "0.6";
    }else if (type == 'wizard') {
      audiobarbarian.pause();
      audiobarbarian.currentTime = 0;
      audiothief.pause();
      audiothief.currentTime = 0;
      audiopaladin.pause();
      audiopaladin.currentTime = 0;
      audiowizard.play();

      document.getElementById("chosepaladin").style.opacity = "0.6";
      document.getElementById("chosebarbarian").style.opacity = "0.6";
      document.getElementById("chosethief").style.opacity = "0.6";
      document.getElementById("chosewizard").style.opacity = "1";
    }
  }
  function chosecharacter(type){
    if (type == 'paladin') {
      icnhero = "<img src='images/Paladin30.png'>";
      cClass = 'paladin';
      playerLives = 3;
      maxLives = 3;
      playerMana = 1;
      maxMana = 1;
      equipment = [0,0,0,0];
      audiohurt = new Audio('sound/hurt.m4a');
      audioplayerdeath = new Audio('sound/playerdeath.m4a');
    }else if (type == 'barbarian') {
      icnhero = "<img src='images/Barbarian30.png'>";
      cClass = 'barbarian';
      playerLives = 4;
      maxLives = 4;
      playerMana = 0;
      maxMana = 0;
      equipment = [0,0,0,0];
      audiohurt = new Audio('sound/barbarianhurt.mp3');
      audioplayerdeath = new Audio('sound/barbariandeath.mp3');
    }else if (type == 'tief') {
      icnhero = "<img src='images/Thief30.png'>";
      cClass = 'barbarian';
      playerLives = 2;
      maxLives = 2;
      playerMana = 1;
      maxMana = 1;
      equipment = [0,0,0,0];
      audiohurt = new Audio('sound/thiefhurt.mp3');
      audioplayerdeath = new Audio('sound/thiefdeath.mp3');
    }else if (type == 'wizard') {
      icnhero = "<img src='images/Wizard30.png'>";
      cClass = 'wizard';
      playerLives = 2;
      maxLives = 2;
      playerMana = 2;
      maxMana = 2;
      equipment = [1,0,0,0];
      audiohurt = new Audio('sound/wizardhurt.mp3');
      audioplayerdeath = new Audio('sound/wizarddeath.mp3');
    }
    createDungeon();
  }

  function addPlayer() {
    var notdone=true;
    while (notdone) {
      var x = Math.floor(Math.random() * 6);
      var y = Math.floor(Math.random() * 6);
      if (matrix[y][x] === 0) {
        matrix[y][x] = 2;
        currentPosition=[y,x];
        notdone = false;
      }
    }
    if (cClass == 'wizard') {
      document.getElementById("equipmentDisplay").innerHTML = icninventory+"<br>"+icnspell;
    }
  }

  function movePlayer(direction) {
    if (!gameHasStarted) {
      return 0;
    }
    if (moveLock) {
      var tileContent = checkTile();

      audiosteps.play();
    if (direction == "N") {
      //get boundary
      if (currentPosition[0]-1 >= 0) {
        //get encounter
        if (matrix[currentPosition[0]-1][currentPosition[1]] == 41 || matrix[currentPosition[0]-1][currentPosition[1]] == 42 || matrix[currentPosition[0]-1][currentPosition[1]] == 43) {
          adventureLog += "Re-engaging Enemy<br>";
          document.getElementById("logDisplay").innerHTML = adventureLog;
          carryOverTarget=[currentPosition[0]-1,currentPosition[1]];
          var enemyLevel = matrix[currentPosition[0]-1][currentPosition[1]]-40;
          displayEnemy(enemyLevel);
          //else move
        }else if (matrix[currentPosition[0]-1][currentPosition[1]] != 1) {
          //get visited tile

          if (matrix[currentPosition[0]-1][currentPosition[1]] != 3) {
            finalScore += 1;
            if (tileContent == "encounter") {
              matrix[currentPosition[0]-1][currentPosition[1]] = createEnemy();
              carryOverTarget=[currentPosition[0]-1,currentPosition[1]];
              var enemyLevel = matrix[currentPosition[0]-1][currentPosition[1]]-40;
              adventureLog += "Level "+(enemyLevel)+" Enemy encountered. You are locked in combat.<br>"
              document.getElementById("logDisplay").innerHTML = adventureLog;

              displayEnemy(enemyLevel);

            } else if (tileContent == "treasure") {
              matrix[currentPosition[0]-1][currentPosition[1]]=5;
              carryOverTarget=[currentPosition[0]-1,currentPosition[1]];
              moveLock = false;
              adventureLog += "Treasure found<br>"
              document.getElementById("logDisplay").innerHTML = adventureLog;

              getTreasure();
            } else {
              adventureLog += "You have progressed in the dungeon<br>"
              document.getElementById("logDisplay").innerHTML = adventureLog;
              matrix[currentPosition[0]-1][currentPosition[1]]=2;
              matrix[currentPosition[0]][currentPosition[1]]=3;
              currentPosition=[currentPosition[0]-1,currentPosition[1]];
              carryOverTarget = [7,7];

              document.getElementById("imgdisplay").innerHTML = getRoom();
            }
            //else just move
          } else {
            adventureLog += "You have progressed in the dungeon<br>"
            document.getElementById("logDisplay").innerHTML = adventureLog;
            matrix[currentPosition[0]-1][currentPosition[1]]=2;
            matrix[currentPosition[0]][currentPosition[1]]=3;
            currentPosition=[currentPosition[0]-1,currentPosition[1]];
            carryOverTarget = [7,7];

            document.getElementById("imgdisplay").innerHTML = getRoom();
          }
        }
      }
    }else if (direction == "S") {
      if (currentPosition[0]+1 < 6){

        if (matrix[currentPosition[0]+1][currentPosition[1]] == 41 || matrix[currentPosition[0]+1][currentPosition[1]] == 42 || matrix[currentPosition[0]+1][currentPosition[1]] == 43) {
          carryOverTarget=[currentPosition[0]+1,currentPosition[1]];
          adventureLog += "Re-engaging Enemy<br>";
          document.getElementById("logDisplay").innerHTML = adventureLog;
          var enemyLevel = matrix[currentPosition[0]+1][currentPosition[1]]-40;
          displayEnemy(enemyLevel);
        //else move
          } else if (matrix[currentPosition[0]+1][currentPosition[1]] != 1) {
        //get visited tile
            if (matrix[currentPosition[0]+1][currentPosition[1]] != 3) {
              finalScore += 1;
              if (tileContent == "encounter") {
                matrix[currentPosition[0]+1][currentPosition[1]] = createEnemy();
                carryOverTarget=[currentPosition[0]+1,currentPosition[1]];
                var enemyLevel = matrix[currentPosition[0]+1][currentPosition[1]]-40;
                adventureLog += "Level "+(enemyLevel)+" Enemy encountered. You are locked in combat.<br>"
                document.getElementById("logDisplay").innerHTML = adventureLog;

                displayEnemy(enemyLevel);

              } else if (tileContent == "treasure") {
                matrix[currentPosition[0]+1][currentPosition[1]]=5;
                carryOverTarget=[currentPosition[0]+1,currentPosition[1]];
                moveLock = false;
                adventureLog += "Treasure found<br>"
                document.getElementById("logDisplay").innerHTML = adventureLog;

                getTreasure();
              } else {
                matrix[currentPosition[0]+1][currentPosition[1]]=2;
                matrix[currentPosition[0]][currentPosition[1]]=3;
                currentPosition=[currentPosition[0]+1,currentPosition[1]];
                carryOverTarget = [7,7];
                adventureLog += "You have progressed in the dungeon<br>"
                document.getElementById("logDisplay").innerHTML = adventureLog;
                document.getElementById("imgdisplay").innerHTML = getRoom();

              }
            //else just move
            } else {
              matrix[currentPosition[0]+1][currentPosition[1]]=2;
              matrix[currentPosition[0]][currentPosition[1]]=3;
              currentPosition=[currentPosition[0]+1,currentPosition[1]];
              carryOverTarget = [7,7];
              adventureLog += "You have progressed in the dungeon<br>"
              document.getElementById("logDisplay").innerHTML = adventureLog;

              document.getElementById("imgdisplay").innerHTML = getRoom();
            }
          }
        }
      }else if (direction == "E") {
      if (currentPosition[1]+1 < 6){
        if (matrix[currentPosition[0]][currentPosition[1]+1] == 41 || matrix[currentPosition[0]][currentPosition[1]+1] == 42 || matrix[currentPosition[0]][currentPosition[1]+1] == 43) {
          carryOverTarget=[currentPosition[0],currentPosition[1]+1];
          adventureLog += "Re-engaging Enemy<br>";
          document.getElementById("logDisplay").innerHTML = adventureLog;
          var enemyLevel = matrix[currentPosition[0]][currentPosition[1]+1]-40;
          displayEnemy(enemyLevel);
        //else move
        } else if (matrix[currentPosition[0]][currentPosition[1]+1] != 1) {

          if (matrix[currentPosition[0]][currentPosition[1]+1] != 3) {
            finalScore += 1;
            if (tileContent == "encounter") {
              matrix[currentPosition[0]][currentPosition[1]+1] = createEnemy();
              carryOverTarget=[currentPosition[0],currentPosition[1]+1];
              var enemyLevel = matrix[currentPosition[0]][currentPosition[1]+1]-40;
              adventureLog += "Level "+(enemyLevel)+" Enemy encountered. You are locked in combat.<br>"
              document.getElementById("logDisplay").innerHTML = adventureLog;

              displayEnemy(enemyLevel);

            } else if (tileContent == "treasure") {
              matrix[currentPosition[0]][currentPosition[1]+1]=5;
              carryOverTarget=[currentPosition[0],currentPosition[1]+1];
              moveLock = false;
              adventureLog += "Treasure found<br>"
              document.getElementById("logDisplay").innerHTML = adventureLog;

              getTreasure();
            } else {
              matrix[currentPosition[0]][currentPosition[1]+1]=2;
              matrix[currentPosition[0]][currentPosition[1]]=3;
              currentPosition=[currentPosition[0],currentPosition[1]+1];
              carryOverTarget = [7,7];
              adventureLog += "You have progressed in the dungeon<br>"
              document.getElementById("logDisplay").innerHTML = adventureLog;

              document.getElementById("imgdisplay").innerHTML = getRoom();
            }
          //else just move
          } else {
            matrix[currentPosition[0]][currentPosition[1]+1]=2;
            matrix[currentPosition[0]][currentPosition[1]]=3;
            currentPosition=[currentPosition[0],currentPosition[1]+1];
            carryOverTarget = [7,7];
            adventureLog += "You have progressed in the dungeon<br>"
            document.getElementById("logDisplay").innerHTML = adventureLog;

            document.getElementById("imgdisplay").innerHTML = getRoom();
          }
        }
      }
    }else if (direction == "W") {
      if (currentPosition[1]-1 >= 0) {
        if (matrix[currentPosition[0]][currentPosition[1]-1] == 41 || matrix[currentPosition[0]][currentPosition[1]-1] == 42 || matrix[currentPosition[0]][currentPosition[1]-1] == 43) {
          carryOverTarget=[currentPosition[0],currentPosition[1]-1];
          adventureLog += "Re-engaging Enemy<br>";
          document.getElementById("logDisplay").innerHTML = adventureLog;
          var enemyLevel = matrix[currentPosition[0]][currentPosition[1]-1]-40;
          displayEnemy(enemyLevel);
        //else move
      } else if (matrix[currentPosition[0]][currentPosition[1]-1] != 1) {

          if (matrix[currentPosition[0]][currentPosition[1]-1] != 3) {
            finalScore += 1;
            if (tileContent == "encounter") {
              matrix[currentPosition[0]][currentPosition[1]-1] = createEnemy();
              carryOverTarget=[currentPosition[0],currentPosition[1]-1];
              var enemyLevel = matrix[currentPosition[0]][currentPosition[1]-1]-40;
              adventureLog += "Level "+(enemyLevel)+" Enemy encountered. You are locked in combat.<br>"
              document.getElementById("logDisplay").innerHTML = adventureLog;

              displayEnemy(enemyLevel);

            } else if (tileContent == "treasure") {
              matrix[currentPosition[0]][currentPosition[1]-1]=5;
              carryOverTarget=[currentPosition[0],currentPosition[1]-1];
              moveLock = false;
              adventureLog += "Treasure found<br>"
              document.getElementById("logDisplay").innerHTML = adventureLog;

              getTreasure();
            } else {
              matrix[currentPosition[0]][currentPosition[1]-1]=2;
              matrix[currentPosition[0]][currentPosition[1]]=3;
              currentPosition=[currentPosition[0],currentPosition[1]-1];
              carryOverTarget = [7,7];
              adventureLog += "You have progressed in the dungeon<br>"
              document.getElementById("logDisplay").innerHTML = adventureLog;

              document.getElementById("imgdisplay").innerHTML = getRoom();
            }
          //else just move
          } else {
            matrix[currentPosition[0]][currentPosition[1]-1]=2;
            matrix[currentPosition[0]][currentPosition[1]]=3;
            currentPosition=[currentPosition[0],currentPosition[1]-1];
            carryOverTarget = [7,7];
            adventureLog += "You have progressed in the dungeon<br>"
            document.getElementById("logDisplay").innerHTML = adventureLog;

            document.getElementById("imgdisplay").innerHTML = getRoom();
          }
        }
      }
    } else if (direction == "NE") {
        if (currentPosition[0]-1 >= 0 && currentPosition[1]+1 < 6) {
          if (matrix[currentPosition[0]-1][currentPosition[1]+1] == 41 || matrix[currentPosition[0]-1][currentPosition[1]+1] == 42 || matrix[currentPosition[0]-1][currentPosition[1]+1] == 43) {
            carryOverTarget=[currentPosition[0]-1,currentPosition[1]+1];
            adventureLog += "Re-engaging Enemy<br>";
            document.getElementById("logDisplay").innerHTML = adventureLog;
            var enemyLevel = matrix[currentPosition[0]-1][currentPosition[1]+1]-40;
            displayEnemy(enemyLevel);
            //else move
        } else if (matrix[currentPosition[0]-1][currentPosition[1]+1] != 1) {

            if (matrix[currentPosition[0]-1][currentPosition[1]+1] != 3) {
              finalScore += 1;
              if (tileContent == "encounter") {
                matrix[currentPosition[0]-1][currentPosition[1]+1] = createEnemy();
                carryOverTarget=[currentPosition[0]-1,currentPosition[1]+1];
                var enemyLevel = matrix[currentPosition[0]-1][currentPosition[1]+1]-40;
                adventureLog += "Level "+(enemyLevel)+" Enemy encountered. You are locked in combat.<br>"
                document.getElementById("logDisplay").innerHTML = adventureLog;

                displayEnemy(enemyLevel);

              } else if (tileContent == "treasure") {
                matrix[currentPosition[0]-1][currentPosition[1]+1]=5;
                carryOverTarget=[currentPosition[0]-1,currentPosition[1]+1];
                moveLock = false;
                adventureLog += "Treasure found<br>"
                document.getElementById("logDisplay").innerHTML = adventureLog;

                getTreasure();
              } else {
                matrix[currentPosition[0]][currentPosition[1]]=3;
                matrix[currentPosition[0]-1][currentPosition[1]+1]=2;
                currentPosition=[currentPosition[0]-1,currentPosition[1]+1];
                carryOverTarget = [7,7];
                adventureLog += "You have progressed in the dungeon<br>"
                document.getElementById("logDisplay").innerHTML = adventureLog;

                document.getElementById("imgdisplay").innerHTML = getRoom();
              }
              //else just move
            } else {
              matrix[currentPosition[0]][currentPosition[1]]=3;
              matrix[currentPosition[0]-1][currentPosition[1]+1]=2;
              currentPosition=[currentPosition[0]-1,currentPosition[1]+1];
              carryOverTarget = [7,7];
              adventureLog += "You have progressed in the dungeon<br>"
              document.getElementById("logDisplay").innerHTML = adventureLog;

              document.getElementById("imgdisplay").innerHTML = getRoom();
          }
        }
      }
    } else if (direction == "NW") {
      if (currentPosition[0]-1 >= 0 && currentPosition[1]-1 >= 0) {
        if (matrix[currentPosition[0]-1][currentPosition[1]-1] == 41 || matrix[currentPosition[0]-1][currentPosition[1]-1] == 42 || matrix[currentPosition[0]-1][currentPosition[1]-1] == 43) {
          carryOverTarget=[currentPosition[0]-1,currentPosition[1]-1];
          adventureLog += "Re-engaging Enemy<br>";
          document.getElementById("logDisplay").innerHTML = adventureLog;
          var enemyLevel = matrix[currentPosition[0]-1][currentPosition[1]-1]-40;
          displayEnemy(enemyLevel);
          //else move
      } else if (matrix[currentPosition[0]-1][currentPosition[1]-1] != 1) {

          if (matrix[currentPosition[0]-1][currentPosition[1]-1] != 3) {
            finalScore += 1;
            if (tileContent == "encounter") {
              matrix[currentPosition[0]-1][currentPosition[1]-1] = createEnemy();
              carryOverTarget=[currentPosition[0]-1,currentPosition[1]-1];
              var enemyLevel = matrix[currentPosition[0]-1][currentPosition[1]-1]-40;
              adventureLog += "Level "+(enemyLevel)+" Enemy encountered. You are locked in combat.<br>"
              document.getElementById("logDisplay").innerHTML = adventureLog;

              displayEnemy(enemyLevel);

            } else if (tileContent == "treasure") {
              matrix[currentPosition[0]-1][currentPosition[1]-1]=5;
              carryOverTarget=[currentPosition[0]-1,currentPosition[1]-1];
              moveLock = false;
              adventureLog += "Treasure found<br>"
              document.getElementById("logDisplay").innerHTML = adventureLog;

              getTreasure();
            } else {
              matrix[currentPosition[0]][currentPosition[1]]=3;
              matrix[currentPosition[0]-1][currentPosition[1]-1]=2;
              currentPosition=[currentPosition[0]-1,currentPosition[1]-1];
              carryOverTarget = [7,7];
              adventureLog += "You have progressed in the dungeon<br>"
              document.getElementById("logDisplay").innerHTML = adventureLog;

              document.getElementById("imgdisplay").innerHTML = getRoom();
            }
            //else just move
          } else {
            matrix[currentPosition[0]][currentPosition[1]]=3;
            matrix[currentPosition[0]-1][currentPosition[1]-1]=2;
            currentPosition=[currentPosition[0]-1,currentPosition[1]-1];
            carryOverTarget = [7,7];
            adventureLog += "You have progressed in the dungeon<br>"
            document.getElementById("logDisplay").innerHTML = adventureLog;

            document.getElementById("imgdisplay").innerHTML = getRoom();
              }
            }
          }
        } else if (direction == "SE") {
          if (currentPosition[0]+1 < 6 && currentPosition[1]+1 < 6) {
            if (matrix[currentPosition[0]+1][currentPosition[1]+1] == 41 || matrix[currentPosition[0]+1][currentPosition[1]+1] == 42 || matrix[currentPosition[0]+1][currentPosition[1]+1] == 43) {
              carryOverTarget=[currentPosition[0]+1,currentPosition[1]+1];
              adventureLog += "Re-engaging Enemy<br>";
              document.getElementById("logDisplay").innerHTML = adventureLog;
              var enemyLevel = matrix[currentPosition[0]+1][currentPosition[1]+1]-40;
              displayEnemy(enemyLevel);
              //else move
          } else if (matrix[currentPosition[0]+1][currentPosition[1]+1] != 1) {

              if (matrix[currentPosition[0]+1][currentPosition[1]+1] != 3) {
                finalScore += 1;
                if (tileContent == "encounter") {
                  matrix[currentPosition[0]+1][currentPosition[1]+1] = createEnemy();
                  carryOverTarget=[currentPosition[0]+1,currentPosition[1]+1];
                  var enemyLevel = matrix[currentPosition[0]+1][currentPosition[1]+1]-40;
                  adventureLog += "Level "+(enemyLevel)+" Enemy encountered. You are locked in combat.<br>"
                  document.getElementById("logDisplay").innerHTML = adventureLog;

                  displayEnemy(enemyLevel);

                } else if (tileContent == "treasure") {
                  matrix[currentPosition[0]+1][currentPosition[1]+1]=5;
                  carryOverTarget=[currentPosition[0]+1,currentPosition[1]+1];
                  moveLock = false;
                  adventureLog += "Treasure found<br>"
                  document.getElementById("logDisplay").innerHTML = adventureLog;

                  getTreasure();
                } else {
                  matrix[currentPosition[0]][currentPosition[1]]=3;
                  matrix[currentPosition[0]+1][currentPosition[1]+1]=2;
                  currentPosition=[currentPosition[0]+1,currentPosition[1]+1];
                  carryOverTarget = [7,7];
                  adventureLog += "You have progressed in the dungeon<br>"
                  document.getElementById("logDisplay").innerHTML = adventureLog;

                  document.getElementById("imgdisplay").innerHTML = getRoom();
                }
                //else just move
              } else {
                matrix[currentPosition[0]][currentPosition[1]]=3;
                matrix[currentPosition[0]+1][currentPosition[1]+1]=2;
                currentPosition=[currentPosition[0]+1,currentPosition[1]+1];
                carryOverTarget = [7,7];
                adventureLog += "You have progressed in the dungeon<br>"
                document.getElementById("logDisplay").innerHTML = adventureLog;

                document.getElementById("imgdisplay").innerHTML = getRoom();
              }
            }
          }
        } else if (direction == "SW") {
            if (currentPosition[0]+1 < 6 && currentPosition[1]-1 >= 0) {
              if (matrix[currentPosition[0]+1][currentPosition[1]-1] == 41 || matrix[currentPosition[0]+1][currentPosition[1]-1] == 42 || matrix[currentPosition[0]+1][currentPosition[1]-1] == 43) {
                carryOverTarget=[currentPosition[0]+1,currentPosition[1]-1];
                adventureLog += "Re-engaging Enemy<br>";
                document.getElementById("logDisplay").innerHTML = adventureLog;
                var enemyLevel = matrix[currentPosition[0]+1][currentPosition[1]-1]-40;
                displayEnemy(enemyLevel);
                //else move
            } else if (matrix[currentPosition[0]+1][currentPosition[1]-1] != 1) {

                if (matrix[currentPosition[0]+1][currentPosition[1]-1] != 3) {
                  finalScore += 1;
                  if (tileContent == "encounter") {
                    matrix[currentPosition[0]+1][currentPosition[1]-1] = createEnemy();
                    carryOverTarget=[currentPosition[0]+1,currentPosition[1]-1];
                    var enemyLevel = matrix[currentPosition[0]+1][currentPosition[1]-1]-40;
                    adventureLog += "Level "+(enemyLevel)+" Enemy encountered. You are locked in combat.<br>"
                    document.getElementById("logDisplay").innerHTML = adventureLog;

                    displayEnemy(enemyLevel);

                  } else if (tileContent == "treasure") {
                    matrix[currentPosition[0]+1][currentPosition[1]-1]=5;
                    carryOverTarget=[currentPosition[0]+1,currentPosition[1]-1];
                    moveLock = false;
                    adventureLog += "Treasure found<br>"
                    document.getElementById("logDisplay").innerHTML = adventureLog;

                    getTreasure();
                  } else {
                    matrix[currentPosition[0]][currentPosition[1]]=3;
                    matrix[currentPosition[0]+1][currentPosition[1]-1]=2;
                    currentPosition=[currentPosition[0]+1,currentPosition[1]-1];
                    carryOverTarget = [7,7];
                    adventureLog += "You have progressed in the dungeon<br>"
                    document.getElementById("logDisplay").innerHTML = adventureLog;

                    document.getElementById("imgdisplay").innerHTML = getRoom();
                  }
                  //else just move
                } else {
                  matrix[currentPosition[0]][currentPosition[1]]=3;
                  matrix[currentPosition[0]+1][currentPosition[1]-1]=2;
                  currentPosition=[currentPosition[0]+1,currentPosition[1]-1];
                  carryOverTarget = [7,7];
                  adventureLog += "You have progressed in the dungeon<br>"
                  document.getElementById("logDisplay").innerHTML = adventureLog;

                  document.getElementById("imgdisplay").innerHTML = getRoom();
                }
              }
            }
          }
      reddrawDungeon();
  }
  }
  function displayEnemy(enemyLevel){
    if (enemyLevel == 1) {

      audioslime.play();
      var choice = Math.floor(Math.random() * 4 +1);
      if (choice == 1) {
        document.getElementById("imgdisplay").innerHTML = imgmonster5;
      } else if (choice == 2) {
        document.getElementById("imgdisplay").innerHTML = imgmonster6;
      }else if (choice == 3) {
        document.getElementById("imgdisplay").innerHTML = imgmonster7;
      }else {
        document.getElementById("imgdisplay").innerHTML = imgmonster8;
      }
    } else if (enemyLevel == 2) {

      audiohulk.play();
      var choice = Math.floor(Math.random() * 4 +1);
      if (choice == 1) {
        document.getElementById("imgdisplay").innerHTML = imgmonster1;
      } else if (choice == 2) {
        document.getElementById("imgdisplay").innerHTML = imgmonster2;
      }else if (choice == 3) {
        document.getElementById("imgdisplay").innerHTML = imgmonster3;
      }else {
        document.getElementById("imgdisplay").innerHTML = imgmonster4;
      }
    }else {

      audiodragon.play();
      var choice = Math.floor(Math.random() * 4 +1);
      if (choice == 1) {
        document.getElementById("imgdisplay").innerHTML = imgmonster9;
      } else if (choice == 2) {
        document.getElementById("imgdisplay").innerHTML = imgmonster10;
      }else if (choice == 3) {
        document.getElementById("imgdisplay").innerHTML = imgmonster11;
      }else {
        document.getElementById("imgdisplay").innerHTML = imgmonster12;
      }
    }
    moveLock = false;
  }
  function getRoom(){
    var choice = Math.floor(Math.random() * 5 +1);
    if (choice == 1) {
      return imgroom6;
    }
    if (choice == 2) {
      return imgroom4;
    }
    if (choice == 3) {
      return imgroom2;
    }
    if (choice == 4) {
      return imgroom1;
    }
    return imgroom3;
  }

  function getTreasure(){
    audiotreasurefind.pause();
		audiotreasurefind.currentTime = 0;
    audiotreasurefind.play();
    var choice = Math.floor(Math.random() * 4 +1);
    if (choice == 1) {
      document.getElementById("imgdisplay").innerHTML = imgtreasure1;
    } else if (choice == 2) {
      document.getElementById("imgdisplay").innerHTML = imgtreasure2;
    }else if (choice == 3) {
      document.getElementById("imgdisplay").innerHTML = imgtreasure3;
    }else {
      document.getElementById("imgdisplay").innerHTML = imgtreasure4;
    }
  }

  function checkTile(){
    var checkRoll = Math.floor(Math.random() * 6 +1);
    var result = "empty";
    if (checkRoll == 4 || checkRoll == 5) {
      result = "encounter";
    } else if (checkRoll == 6) {
      result = "treasure";
    }
    if (cClass == "tief" && checkRoll == 1) {
      result = "treasure";
    }
    return result;
  }

  function createEnemy() {
    var checkRoll = Math.floor(Math.random() * 6)+1;
    //checkRoll = Math.round(checkRoll/2);
    switch (checkRoll) {
      case 1:
      case 2:
      case 3:
        checkRoll=1;
        break;
        case 4:
        case 5:
          checkRoll=2;
          break;
      default:
        checkRoll=3;
    }
    checkRoll = 40+checkRoll;
    return checkRoll;
  }

  function combat(type){
    if (!gameHasStarted) {
      return 0;
    }
    if (carryOverTarget[0] != 7) {

      if (matrix[carryOverTarget[0]][carryOverTarget[1]] == 41 || matrix[carryOverTarget[0]][carryOverTarget[1]] == 42 || matrix[carryOverTarget[0]][carryOverTarget[1]] == 43) {
        if (combatResolution(type)) {

          audiomonsterkill.play();
          matrix[carryOverTarget[0]][carryOverTarget[1]]=2;
          matrix[currentPosition[0]][currentPosition[1]]=3;
          currentPosition=[carryOverTarget[0],carryOverTarget[1]];
          adventureLog += "Monster Slain!<br>"
          document.getElementById("imgdisplay").innerHTML = imgroomsplat;
          document.getElementById("logDisplay").innerHTML = adventureLog;
        } else {

          audiohurt.play();
          playerLives = playerLives-1;
          adventureLog += "You have lost health<br>"
          document.getElementById("logDisplay").innerHTML = adventureLog;

        }
      }
      if (playerLives == 0) {
        pauseAllAudio();
        audioplayerdeath.play();
        adventureLog += "You have died!<br>"
        document.getElementById("logDisplay").innerHTML = adventureLog;
        gameHasStarted = false;
        document.getElementById("map").innerHTML = "<div style='color:lightred;text-shadow: 1px 1px 2px red;'>GAME OVER!<p>YOU DIED!<p>Final Score:"+finalScore+"</div><button type='button' name='button' onclick='location.reload()' class='directionalbutton'>"+increstart+"</button>";
        document.getElementById("imgdisplay").innerHTML = imgdeath;
        redrawhud();
      }else {
        moveLock = true;
        reddrawDungeon();
      }

    }
  }

  function combatResolution(type) {
    var casting = false;
    if (equipment[0] == 0 && type == "spell") {
      adventureLog += "You have no spell. You stand around and do nothing.<br>"
      document.getElementById("logDisplay").innerHTML = adventureLog;
    }else if (playerMana == 0 && type == "spell") {
      adventureLog += "You have no mana. You stand around and do nothing.<br>"
      document.getElementById("logDisplay").innerHTML = adventureLog;
    } else if (type == "spell") {
      casting=true;
    }
    if (casting) {

      audiospell.play();
      adventureLog += "You vanquished the monster with a spell<br>"
      document.getElementById("logDisplay").innerHTML = adventureLog;

      showOverlay("spell");

      if (playerLVL < 3) {
        playerlvlP += 1;
      }
      if (playerlvlP == 3 && playerLVL < 3) {
        playerLVL += 1;
        playerlvlP = 0;
      }
      playerMana -= 1;
      finalScore += 2;
      return true;
    }else if (type == "attack") {

      audioslash.play();
      adventureLog += "You attack the monster<br>"
      document.getElementById("logDisplay").innerHTML = adventureLog;

      showOverlay("strike");

      var checkRoll = Math.floor(Math.random() * 6)+1;
      adventureLog += "You roll a "+checkRoll+"<br>"
      document.getElementById("logDisplay").innerHTML = adventureLog;
      // add checks here for sword and shield
      var modifier = 0;
      if (equipment[1] == 1) {
        modifier = 1;
      }
      if (equipment[2] == 1) {
        checkRoll += 1;
      }
      //get monster
      var monsterLvl = matrix[carryOverTarget[0]][carryOverTarget[1]] - 41;
      var playerLVLm = playerLVL-1;
      var winLoseMatrix = [
        [3,2,1],
        [4,3,2],
        [6,4,3]
      ];
        if (checkRoll >= winLoseMatrix[monsterLvl][playerLVLm]-modifier) {
          finalScore += 2;
          if (playerLVL < 3) {
            playerlvlP += 1;
          }
          if (playerlvlP == 3 && playerLVL < 3) {

            audiolvlup.play();
            playerLVL += 1;
            playerlvlP = 0;
            finalScore += 1;
          }
          return true;
        }
        showOverlay("hurt");
        return false;
    }
  }

  async function showOverlay(type){
    if (type == "spell") {
      document.getElementById("imgoverlay").innerHTML = imgspellcast;
    }else if (type == "strike") {
      document.getElementById("imgoverlay").innerHTML = imgswordstrike;
    } else if(type == "hurt"){
      document.getElementById("imgoverlay").innerHTML = imgbloodsplat;
    }else if (type == "gethealth") {
      document.getElementById("imgoverlay").innerHTML = imggethealthpotion;
    }else if (type == "getmana") {
      document.getElementById("imgoverlay").innerHTML = imggetmanapotion;
    }else if (type == "getspell") {
      document.getElementById("imgoverlay").innerHTML = imggetspell;
    }else if (type == "getsshield") {
      document.getElementById("imgoverlay").innerHTML = imggetshield;
    }else if (type == "getsword") {
      document.getElementById("imgoverlay").innerHTML = imggetsword;
    }

    document.getElementById("imgoverlay").style.visibility = "visible";
    document.getElementById("imgoverlay").style.opacity = "1";
    await sleep(1000); //id: imgoverlay
    document.getElementById("imgoverlay").style.opacity = "0";
    await sleep(1000);
    document.getElementById("imgoverlay").style.visibility = "hidden";
  }

  function createTreasure(){
    finalScore += 1;

    audiotreasure.play();
    var checkRoll = Math.floor(Math.random() * 6)+1;
    switch (checkRoll) {
      case 1:
        if (playerLives < maxLives) {
          playerLives +=1;
        }
        adventureLog += "You found a health potion.<br>";
        document.getElementById("logDisplay").innerHTML = adventureLog;

        showOverlay("gethealth");
        break;
      case 2:
        if (playerMana < maxMana) {
          playerMana +=1;
        }
        adventureLog += "You found a mana potion.<br>";
        document.getElementById("logDisplay").innerHTML = adventureLog;

        showOverlay("getmana");
        break;
      case 3:
        equipment[0] = 1 ;//[spell, shield, sword]
        adventureLog += "You found a destructive spell created by the wisest wizards.<br>";
        document.getElementById("logDisplay").innerHTML = adventureLog;
        finalScore += 1;

        showOverlay("getspell");
        break;
      case 4:
        equipment[1] = 1 ;//[spell, shield, sword]
        adventureLog += "You found a shield forged by the gods.<br>"
        document.getElementById("logDisplay").innerHTML = adventureLog;
        finalScore += 1;

        showOverlay("getsshield");
        break;
      case 5:
        equipment[2] = 1 ;//[spell, shield, sword]
        adventureLog += "You found a legendary sword that was once held by a hero.<br>";
        document.getElementById("logDisplay").innerHTML = adventureLog;
        finalScore += 1;


        showOverlay("getsword");
        break;
      case 6:
        gameHasStarted = false;
        equipment[3] = 1;
        finalScore += 3;
        pauseAllAudio();
        audiowin.play();
        document.getElementById("map").innerHTML = "<div style='color:lightgreen;text-shadow: 1px 1px 2px #000000;'>Congratulations, you won!<p>However, more adventures await you!<p>Final Score:"+finalScore+"</div><p><button type='button' name='button' onclick='location.reload()' class='directionalbutton'>"+increstart+"</button>";
        adventureLog += "You found the long lost treasure. Ritches beyond your imagination are laying before your eyes.<br>";
        document.getElementById("logDisplay").innerHTML = adventureLog;
        document.getElementById("imgdisplay").innerHTML = imgwin1;

        break;
    }
    var output = icninventory+"<br>";
    if (equipment[0] == 1) {
      output += icnspell;
    }
    if (equipment[1] == 1) {
      output += icnshield;
    }
    if (equipment[2] == 1) {
      output += icnsword;
    }

    document.getElementById("equipmentDisplay").innerHTML = output;
  }

  function openTreasure(){
    if (!gameHasStarted) {
      return 0;
    }
    if (carryOverTarget[0] != 7) {
      if (matrix[carryOverTarget[0]][carryOverTarget[1]] == 5){
        createTreasure();
        matrix[carryOverTarget[0]][carryOverTarget[1]]=2;
        matrix[currentPosition[0]][currentPosition[1]]=3;
        currentPosition=[carryOverTarget[0],carryOverTarget[1]];
        moveLock = true;
        //REDRAW MUST CHECK WINSTATE
        if (equipment[3] == 0) {
          reddrawDungeon();
        }
      }
    }
  }

  function reddrawDungeon(){

    var mapstring = "<table class='maptable'>";
      //var countZeroes = 0;
      var wincondition = true;
      for (let i = 0; i < matrix.length; i++) {
        mapstring += "<tr>";
          for (let j = 0; j < matrix[i].length; j++) {
            if (matrix[i][j] === 0) {
              //countZeroes += 1;
              mapstring += "<td style='background-image: url(\""+imgdarktile+"\");'></td>";

            }else if (matrix[i][j] === 1) {
              mapstring += "<td style='background-image: url(\""+imgwalltile+"\");'></td>";
            }else if (matrix[i][j] === 2) {
              mapstring += "<td style='background-image: url(\""+imglighttile+"\");text-align:center'>"+icnhero+"</td>";
                yp = i+1;
                if (yp == 6) {
                  yp = 5;
                }
                ym = i-1;
                if (ym == -1) {
                  ym = 0;
                }
                xp = j+1;
                if (xp == 6) {
                  xp = 5;
                }
                xm = j-1;
                if (xm == -1) {
                  xm = 0;
                }
                //console.log("yp:"+yp+" ym:"+ym+" xm:"+xm+" xp:"+xp);
                //yp:1 ym:0 xm:4 xp:5

              if (matrix[yp][xp] == 0 || matrix[yp][xm] == 0  || matrix[ym][xm] == 0 || matrix[ym][xp] == 0 || matrix[yp][j] == 0 || matrix[ym][j] == 0 || matrix[i][xm] == 0 || matrix[i][xp] == 0 || matrix[yp][xp] == 2 || matrix[yp][xm] == 2  || matrix[ym][xm] == 2 || matrix[ym][xp] == 2 || matrix[yp][j] == 2 || matrix[ym][j] == 2 || matrix[i][xm] == 2 || matrix[i][xp] == 2) {
                wincondition = false;
              }
            }else if (matrix[i][j] === 3) {
              mapstring += "<td style='background-image: url(\""+imglighttile+"\")'></td>";
              yp = i+1;
              if (yp == 6) {
                yp = 5;
              }
              ym = i-1;
              if (ym == -1) {
                ym = 0;
              }
              xp = j+1;
              if (xp == 6) {
                xp = 5;
              }
              xm = j-1;
              if (xm == -1) {
                xm = 0;
              }

            if (matrix[yp][xp] == 0 || matrix[yp][xm] == 0  || matrix[ym][xm] == 0 || matrix[ym][xp] == 0 || matrix[yp][j] == 0 || matrix[ym][j] == 0 || matrix[i][xm] == 0 || matrix[i][xp] == 0) {
              wincondition = false;
            }
            }else if (matrix[i][j] === 41) {
              mapstring += "<td style='background:yellow'>"+icnskull1+"</td>";
            }else if (matrix[i][j] === 42) {
              mapstring += "<td style='background:red'>"+icnskull2+"</td>";
            }else if (matrix[i][j] === 43) {
              mapstring += "<td style='background:darkred'>"+icnskull3+"</td>";
            }else if (matrix[i][j] === 5) {
              mapstring += "<td style='background:green;text-align:center'>"+icnchest+"</td>";
            }
          }
          mapstring += "</tr>";
        }
        mapstring += "</table>"
        document.getElementById("map").innerHTML = mapstring;

        redrawhud();

        //if (countZeroes == 0) {
        if (wincondition){
          gameHasStarted = false;
          pauseAllAudio();

          audiowin.play();
          document.getElementById("map").innerHTML = "<div style='color:lightgreen;text-shadow: 1px 1px 2px #000000;'>Congratulations, you won!<p>However, more adventures await you!<p>Final Score:"+finalScore+"</div><p><button type='button' name='button' onclick='location.reload()' class='directionalbutton'>"+increstart+"</button>";
          adventureLog += "You have explored the complete dungeon. There is nothing left to see here, time for another adventure.<br>";
          document.getElementById("logDisplay").innerHTML = adventureLog;
          document.getElementById("imgdisplay").innerHTML = imgwin2;
        }
    }
    function redrawhud() {
      var output = incstats+"<br>";
      output += inclife+" ";
      for (let i = 0; i < playerLives; i++) {
        output += icnlifepoint+" ";
      }
      output += "<br>";
      output += incmana+" ";
      for (let i = 0; i < playerMana; i++) {
        output += icnmanapoint+" ";
      }
      output += "<br>";
      output += inclvl+" ";
      for (let i = 0; i < playerLVL; i++) {
        output += icnlvlpoint;
      }
      output += "<br>";
      output += incprog+" ";
      for (let i = 0; i < playerlvlP; i++) {
        output += icnlvlpoint;
      }
      output += "<p></p>";

      document.getElementById("hud").innerHTML = output;
    }

    function pauseAllAudio(){
      audioslime.pause();
      audiohulk.pause();
      audiodragon.pause();
      audiotreasure.pause();
      audiobgm.pause();
      audiosteps.pause();
    }

  </script>

<div id="preloader" style="display:none;">
  <img src='images/Paladin30.png'><img src='images/Barbarian30.png'><img src='images/Thief30.png'><img src='images/Wizard30.png'>
  <img src='images/Paladinbig.png'><img src='images/Barbarianbig.png'><img src='images/Thiefbig.png'><img src='images/Wizardbig.png'>
  <img src='images/lvlpoint.png'><img src='images/lvlpoint.png'><img src='images/manapoint.png'><img src='images/lifepoint.png'>
  <img src='images/Skull130.png'><img src='images/Skull230.png'><img src='images/Skull330.png'><img src='images/chest30.png'>
  <img src='images/inventory.png'><img src='images/spell2.png'><img src='images/shield2.png'><img src='images/sword2.png'>
  <img src='images/death1GO.jpeg'><img src='images/win1GO.jpeg'><img src='images/win2GO.jpeg'>
  <img src='images/treasure1.jpeg'><img src='images/treasure2.jpeg'><img src='images/treasure3.jpeg'><img src='images/treasure4.jpeg'>
  <img src='images/Monster1.jpeg'><img src='images/Monster2.jpeg'><img src='images/Monster3.jpeg'><img src='images/Monster4.jpeg'><img src='images/Monster5.jpeg'><img src='images/Monster6.jpeg'><img src='images/Monster7.jpeg'><img src='images/Monster8.jpeg'><img src='images/Monster9.jpeg'><img src='images/Monster10.jpeg'><img src='images/Monster11.jpeg'><img src='images/Monster12.jpeg'>
  <img src='images/room5splatter.jpeg'>
  <img src='images/entrance2ST.jpeg'><img src='images/entrance2.jpeg'>
  <img src='images/room6.jpeg'><img src='images/room4.jpeg'><img src='images/room2.jpeg'><img src='images/room1.jpeg'><img src='images/room3.jpeg'>
  <img src='images/bloodsplat.png'><img src='images/swordstrike.png'><img src='images/spellcast.png'><img src='images/gethealthpotion.png'><img src='images/getmanapotion.png'><img src='images/getsword.png'><img src='images/getshield.png'><img src='images/getspell.png'>
  <img src='images/imgdarktile.png'><img src='images/imglighttile.png'><img src='images/imgwalltile.png'>
</div>
</body>
